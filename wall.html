<!DOCTYPE html>
<head>
<title>Wall of Shame</title>
<link rel="stylesheet" type="text/css" href="wall.css">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,700&amp;subset=latin" rel="stylesheet" type="text/css">
<body>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script>
/* Fixed scale so people can see the change over time. */
var x = d3.scale.linear()
    .domain([0, 20])
    .range([0, 420]);

function dteam(d) {
    var team = d.team;
    if (team === "community managers") {
        return "ComMgrs";
    }
    if (team === "author") {
        return "(author)";
    }
    return team;
}

d3.json("wall.json", function(data) {
    var tr = d3.select("#chart")
        .selectAll("tr")
            .data(data.teams)
        .enter().append("tr");
        
    tr.append("td").attr("class", "team").text(dteam);
    tr.append("td").attr("class", "total").text(function (d) { return d.total; });
    var bars = tr.append("td").append("div").attr("class", "bar")
    
    function intext(d, bucket) {
        return d.internal[bucket].length + d.external[bucket].length;
    }

    data.buckets.forEach(function (bucket, i) {
        bars.append("span").attr("class", "bucket bucket"+i)
            .style("width", function (d) {
                return x(intext(d, bucket)) + "px";
            })
            .append("span").attr("class", "count")
            .text(function (d) { 
                var count = intext(d, bucket);
                return count > 3 ? count : "";
            });
    });

    d3.select("#legend").selectAll("span")
        .data(data.buckets)
        .enter().append("span")
            .attr("class", function (d, i) { return "bucket bucket"+i; })
            .text(function (d) { return d; });

});
</script>

<table id="chart"></table>
<div id="legend"></div>
